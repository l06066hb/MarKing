# 故障排查指南

本指南帮助你解决 MarKing 使用过程中遇到的常见问题。

---

## 📋 目录

- [安装问题](#安装问题)
- [启动问题](#启动问题)
- [编辑器问题](#编辑器问题)
- [预览问题](#预览问题)
- [导出问题](#导出问题)
- [文件管理问题](#文件管理问题)
- [性能问题](#性能问题)
- [数据问题](#数据问题)
- [日志收集](#日志收集)

---

## 安装问题

### 问题 1: Windows 安装器无法运行

**症状**: 双击安装器后没有反应或提示错误

**可能原因**:
1. 系统版本不兼容
2. 缺少必要的运行库
3. 被杀毒软件拦截
4. 文件损坏

**解决方案**:

1. **检查系统版本**
   ```
   要求: Windows 10 或更高版本
   检查: 设置 → 系统 → 关于
   ```

2. **以管理员身份运行**
   - 右键点击安装器
   - 选择"以管理员身份运行"

3. **检查杀毒软件**
   - 临时禁用杀毒软件
   - 将 MarKing 添加到白名单

4. **重新下载**
   - 删除当前文件
   - 从官方渠道重新下载

### 问题 2: 应用无法启动

**症状**: 点击图标后没有反应或闪退

**可能原因**:
1. 数据库损坏
2. 配置文件错误
3. 权限问题
4. 端口占用

**解决方案**:

1. **检查进程**
   - Windows: 任务管理器中结束 MarKing 进程

2. **重置配置**
   - 备份数据目录
   - 删除配置文件
   - 重新启动应用

3. **查看日志**
   - 打开日志文件(见下文)
   - 查找错误信息
   - 根据错误信息解决

4. **重新安装**
   - 完全卸载应用
   - 删除数据目录(备份后)
   - 重新安装

### 问题 3: 启动很慢

**症状**: 应用启动需要很长时间

**可能原因**:
1. 文档数量过多
2. 数据库过大
3. 缓存文件过多
4. 系统资源不足

**解决方案**:

1. **清理缓存**
   ```
   数据目录/cache/ - 删除此文件夹
   ```

2. **归档旧文档**
   - 导出不常用的文档
   - 从数据库中删除

3. **优化数据库**
   - 使用内置的数据库优化功能
   - 或重建数据库

4. **增加系统资源**
   - 关闭其他程序
   - 增加可用内存

---

## 编辑器问题

### 问题 6: 编辑器无法输入

**症状**: 点击编辑器后无法输入文字

**可能原因**:
1. 编辑器未获得焦点
2. 文档被锁定
3. 输入法冲突
4. 编辑器崩溃

**解决方案**:

1. **重新获取焦点**
   - 点击编辑器区域
   - 或按 `Ctrl+L` 聚焦编辑器

2. **检查文档状态**
   - 确认文档未被锁定
   - 检查是否有写入权限

3. **切换输入法**
   - 切换到英文输入法
   - 或重启输入法

4. **刷新编辑器**
   - 按 `F5` 刷新
   - 或重新打开文档

### 问题 7: 代码片段不工作

**症状**: 输入触发词后按 Tab 没有反应

**可能原因**:
1. 触发词拼写错误
2. 光标位置不对
3. 代码片段功能被禁用
4. 快捷键冲突

**解决方案**:

1. **检查触发词**
   - 按 `?` 查看所有可用片段
   - 确认触发词拼写正确

2. **检查光标位置**
   - 确保光标在行首或空白处
   - 不要在单词中间触发

3. **检查设置**
   - 设置 → 编辑器 → 代码片段
   - 确认功能已启用

4. **重新加载**
   - 重启应用
   - 或重新加载编辑器

### 问题 8: 语法高亮不正常

**症状**: 代码块或 Markdown 语法没有高亮

**可能原因**:
1. 主题问题
2. 语言识别错误
3. 编辑器配置错误

**解决方案**:

1. **切换主题**
   - 尝试切换到其他主题
   - 确认主题支持语法高亮

2. **指定语言**
   ```markdown
   ```javascript
   // 明确指定语言
   ```
   ```

3. **重置编辑器**
   - 设置 → 编辑器 → 重置默认设置

---

## 预览问题

### 问题 9: 预览不更新

**症状**: 编辑内容后预览区没有更新

**可能原因**:
1. 实时预览被禁用
2. 预览渲染错误
3. 滚动同步问题

**解决方案**:

1. **检查实时预览**
   - 设置 → 预览 → 实时预览
   - 确认功能已启用

2. **手动刷新**
   - 按 `F5` 刷新预览
   - 或点击工具栏刷新按钮

3. **重新打开文档**
   - 关闭当前文档
   - 重新打开

### 问题 10: 图片不显示

**症状**: 预览区图片显示为空白或错误图标

**可能原因**:
1. 图片路径错误
2. 图片文件不存在
3. 图片格式不支持
4. 权限问题

**解决方案**:

1. **检查路径**
   ```markdown
   # 相对路径(推荐)
   ![图片](./assets/image.png)
   
   # 绝对路径
   ![图片](/path/to/image.png)
   ```

2. **检查文件**
   - 确认图片文件存在
   - 确认文件名大小写正确

3. **检查格式**
   - 支持: PNG, JPG, GIF, SVG, WebP
   - 不支持: BMP, TIFF 等

4. **重新插入**
   - 删除图片引用
   - 重新拖拽或粘贴图片

### 问题 11: 数学公式不渲染

**症状**: LaTeX 公式显示为原始代码

**可能原因**:
1. 语法错误
2. 渲染引擎未加载
3. 主题不支持

**解决方案**:

1. **检查语法**
   ```markdown
   # 行内公式
   $E = mc^2$
   
   # 块级公式
   $$
   \int_0^\infty e^{-x^2} dx = \frac{\sqrt{\pi}}{2}
   $$
   ```

2. **刷新预览**
   - 按 `F5` 刷新
   - 等待渲染引擎加载

3. **切换主题**
   - 某些主题可能不支持公式
   - 尝试切换到其他主题

---

## 导出问题

### 问题 12: 导出失败

**症状**: 点击导出后提示错误或没有反应

**可能原因**:
1. 文件名非法
2. 路径不存在
3. 权限不足
4. 磁盘空间不足
5. 导出引擎错误

**解决方案**:

1. **检查文件名**
   - 不要使用特殊字符: `\ / : * ? " < > |`
   - 使用简单的文件名

2. **检查路径**
   - 确认导出目录存在
   - 使用简短的路径

3. **检查权限**
   - 确认有写入权限
   - 尝试导出到其他位置

4. **检查空间**
   - 确认磁盘有足够空间
   - 至少预留 100MB

5. **查看日志**
   - 查看错误日志
   - 根据错误信息解决

### 问题 13: 导出的 DOCX 格式不对

**症状**: 导出的 Word 文档格式混乱

**可能原因**:
1. 模板选择不当
2. 配置参数错误
3. Markdown 语法不标准
4. 图片处理问题

**解决方案**:

1. **选择合适模板**
   - 学术论文: 适合正式文档
   - 商务报告: 适合商业文档
   - 简约风格: 适合简单文档

2. **调整配置**
   - 页边距: 根据需要调整
   - 字体大小: 根据需要调整
   - 行距: 根据需要调整

3. **规范 Markdown**
   - 使用标准语法
   - 避免嵌套过深
   - 简化复杂结构

4. **重新导出**
   - 尝试不同的配置
   - 或导出为 PDF 后转换

### 问题 14: 导出的 PDF 模糊

**症状**: PDF 文件中的文字或图片模糊

**可能原因**:
1. 图片分辨率低
2. 导出设置不当
3. 渲染引擎问题

**解决方案**:

1. **使用高分辨率图片**
   - 至少 300 DPI
   - 避免过度缩放

2. **调整导出设置**
   - 选择高质量选项
   - 增加 DPI 设置

3. **尝试其他方式**
   - 先导出 HTML
   - 使用浏览器打印为 PDF

---

## 文件管理问题

### 问题 15: 文件无法保存

**症状**: 编辑后提示保存失败

**可能原因**:
1. 磁盘空间不足
2. 文件被占用
3. 权限不足
4. 路径过长

**解决方案**:

1. **清理磁盘**
   - 删除不需要的文件
   - 清空回收站

2. **关闭其他程序**
   - 关闭可能占用文件的程序
   - 如云同步软件

3. **检查权限**
   - 确认有写入权限
   - 以管理员身份运行

4. **缩短路径**
   - 移动文件到更短的路径
   - 避免深层嵌套

### 问题 16: 文件搜索不到

**症状**: 明明存在的文件搜索不到

**可能原因**:
1. 索引未更新
2. 搜索关键词不对
3. 文件被排除
4. 数据库问题

**解决方案**:

1. **重建索引**
   - 设置 → 搜索 → 重建索引
   - 等待索引完成

2. **调整搜索**
   - 使用不同的关键词
   - 尝试模糊搜索

3. **检查过滤**
   - 确认文件未被过滤
   - 检查搜索范围设置

4. **刷新文件树**
   - 按 `F5` 刷新
   - 或重启应用

---

## 性能问题

### 问题 17: 编辑卡顿

**症状**: 输入文字时有明显延迟

**可能原因**:
1. 文件过大
2. 实时预览负担重
3. 系统资源不足
4. 插件冲突

**解决方案**:

1. **拆分文件**
   - 将大文件拆分成多个小文件
   - 每个文件不超过 1MB

2. **关闭实时预览**
   - 临时禁用实时预览
   - 编辑完成后再启用

3. **释放资源**
   - 关闭其他程序
   - 重启电脑

4. **简化文档**
   - 减少图片数量
   - 简化复杂格式

### 问题 18: 内存占用高

**症状**: 应用占用大量内存

**可能原因**:
1. 打开文档过多
2. 缓存过多
3. 内存泄漏
4. 图片过多

**解决方案**:

1. **关闭不用的文档**
   - 只保留当前编辑的文档
   - 关闭其他标签页

2. **清理缓存**
   - 删除缓存文件夹
   - 重启应用

3. **重启应用**
   - 定期重启应用
   - 释放内存

4. **优化图片**
   - 压缩图片大小
   - 使用合适的分辨率

---

## 数据问题

### 问题 19: 数据丢失

**症状**: 文档或数据突然消失

**可能原因**:
1. 误删除
2. 数据库损坏
3. 同步冲突
4. 软件 Bug

**解决方案**:

1. **检查回收站**
   - 应用内回收站
   - 系统回收站

2. **恢复快照**
   - 使用版本快照功能
   - 恢复到之前的版本

3. **恢复备份**
   - 使用备份文件恢复
   - 选择最近的备份

4. **检查数据库**
   - 使用数据库工具检查
   - 尝试修复数据库

5. **联系支持**
   - 如果以上方法都无效
   - 在 GitHub 提交 Issue

### 问题 20: 数据库损坏

**症状**: 应用提示数据库错误

**可能原因**:
1. 异常关闭
2. 磁盘错误
3. 文件损坏

**解决方案**:

1. **备份数据**
   - 立即备份数据目录
   - 防止进一步损坏

2. **修复数据库**
   - 使用内置修复工具
   - 或使用 SQLite 工具修复

3. **重建数据库**
   - 导出所有文档
   - 删除数据库文件
   - 重新导入文档

4. **恢复备份**
   - 如果修复失败
   - 使用备份恢复

---

## 日志收集

### 如何收集日志

当你需要报告问题时，日志文件非常重要。

### 日志位置

- **Windows**: `C:\Users\用户名\AppData\Roaming\com.marking.app\logs\`

> **注意**：v1.0.8 开始，所有应用数据统一存储在 `com.marking.app` 目录。

### 收集步骤

1. **打开日志目录**
   - 使用上面的路径
   - 或在应用中: 帮助 → 打开日志目录

2. **找到最新日志**
   - 按修改时间排序
   - 选择最新的日志文件

3. **复制日志**
   - 复制整个日志文件
   - 或复制相关的错误信息

4. **附加到 Issue**
   - 在 GitHub Issue 中附加日志
   - 或粘贴相关部分

### 日志内容

日志文件包含:
- 应用启动信息
- 错误和警告
- 操作记录
- 性能数据

**注意**: 日志可能包含文件路径等信息，请检查后再分享。

---

## 获取更多帮助

如果以上方法都无法解决你的问题，请通过以下方式获取帮助：

### 报告问题

1. **GitHub Issues**
   - 访问: https://github.com/l06066hb/MarKing/issues
   - 点击 "New Issue"
   - 选择 "Bug 报告" 模板
   - 填写详细信息

2. **包含信息**
   - 问题描述
   - 复现步骤
   - 系统信息
   - 日志文件
   - 截图(如适用)

### 社区讨论

- **GitHub Discussions**: https://github.com/l06066hb/MarKing/discussions
- 提问和讨论
- 分享经验
- 获取帮助

### 查看文档

- **FAQ**: [常见问题](FAQ.md)
- **README**: [完整文档](../README.md)
- **贡献指南**: [CONTRIBUTING.md](../CONTRIBUTING.md)

---

## 预防措施

### 定期备份

- 启用自动备份
- 定期手动备份
- 保留多个备份版本

### 及时更新

- 使用最新版本
- 关注更新通知
- 查看更新日志

### 规范使用

- 遵循最佳实践
- 避免异常操作
- 定期清理缓存

---

**最后更新**: 2026-02-03

希望这个指南能帮助你解决问题！如果还有疑问，欢迎随时联系我们。🙏
